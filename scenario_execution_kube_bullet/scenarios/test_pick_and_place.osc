
import osc.kube_bullet

scenario test_pick_and_place:
    ur10e_cell: manipulator with:
        keep(it.active_components == "ur10e;robotiq_gripper")
        keep(it.model == '/localdisk/fmirus/git/1source/kube-bullet/kube_bullet/robots/robot_assets/ur10e_cell/ur10e_cell.bullet.config.yaml')
    cube_1: bullet_object with:
        keep(it.model == '/localdisk/fmirus/git/1source/kube-bullet/kube_bullet/objects/object_assets/cube/cube.bullet.config.yaml')
    rs_eef_camera: bullet_camera with:
        keep(it.parent_body  == 'ur10e_cell__ur10e')
        keep(it.parent_link == 'camera_link')
        keep(it.auto_rendering == true)
        keep(it.intrinsic_param  == '450;0;320;0;450;240;0;0;1')
    do parallel:
        serial:
            ur10e_cell.spawn_robot()
            wait elapsed(5s)
            cube_1.spawn_object() with:
                keep(it.position == '0.5;-0.2;1.0')
                keep(it.flags == 'SHOW_BASE_POSE')
            wait elapsed(1s)
            rs_eef_camera.spawn_camera()
            wait elapsed(4s)
            ur10e_cell.send_joint_position() with:
                keep(it.component == 'ur10e')
                keep(it.position == '-0.3;-1.57079632;1.57079632;-1.57079632;-1.57079632;-0.3')
            ur10e_cell.move_eef_through_poses() with:
                keep(it.component == 'ur10e')
                keep(it.threshold == 0.01m)
                keep(it.link_name == 'tcp_link')
                keep(it.poses == '0.5,-0.2,1.15,0,0,0;0.5,-0.2,1.0,0,0,0')
            ur10e_cell.move_gripper() with:
                keep(it.component == 'robotiq_gripper')
                keep(it.action_type == 'close')
            wait elapsed(2s)
            ur10e_cell.move_eef_through_poses() with:
                keep(it.component == 'ur10e')
                keep(it.link_name == 'tcp_link')
                keep(it.threshold == 0.01m)
                keep(it.poses == '0.5,-0.2,1.15,0,0,0')
            emit end
        time_out: serial:
            wait elapsed(60s)
            time_out_shutdown: emit fail
